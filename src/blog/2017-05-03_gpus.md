---
title: TensorFlow with GPUs: Fast
date: 2017-05-03
author: Kevin Klues, Mesosphere
category: services
description: Let's try out TensorFlow with GPU acceleration.
layout: article.jade
collection: posts
lunr: true
---

# History
You can thank games like Halo and their demanding fan base for drasticly accelerating big data workloads. In 2002, researchers discovered how to program and repurpose the graphics processor units (GPUs) that render better-than-real-looking worlds and fluid character movements. See this [Nvidia presentation](http://www.nvidia.com/content/gtc-2010/pdfs/2275_gtc2010.pdf) for a detailed and delightfully nerdy history of GPUs, from the earliest graphics processor methods to today.

# GPUs today

Today, we can use GPUs for particular kinds of data-intensive tasks, like neural networks.

# GPUs on Mesos: They're supported!
As of Mesos 1.0.0, [Apache Mesos supports GPUs](http://mesos.apache.org/documentation/latest/gpu-support/), allowing you to declare GPU resources for a service as easily as you can any other resource, like memory or CPU.

## Isolation
One major challenge for the Mesos team was enforcing GPU isolation on hosts. Before this was completed, any service could use a host with a GPU, effectively blocking the applications that _need_ the GPUs from accessing them. Now that there is native isolation, GPUs on Mesos are ready for prime time.

# GPUs on DC/OS: They're available out of the box
On DC/OS, it's even easier to use GPUs to accelerate your data-intensive services. GPU support is available out-of-the-box.

# Use GPUs on DC/OS
So how do you get started? At a high level, you need at least one machine in your cluster with GPUs  and the appropriate Nvidia libraries installed or an Amazon AMI that includes them.

After you install DC/OS, all you need to do is declare GPU requirements in your application definition, like any other resource. Here are the details.

# Tensorflow Demo Part I
[Tensorflow](https://www.tensorflow.org) is a machine intelligence library with architecture specially configured to leverage GPUs for speed and efficiency. We’re going to use it to launch a convolutional neural network example on your local machine.

In this post we’re going to:
- Install TensorFlow locally.
- Run a neural networking example without GPUs.
- Install CUDA drivers and nvidia-docker.
- Run and time a neural networking example.
- Run the same example with GPUs and compare the results.
- Run a multi-GPU example.

## Prerequisite
Docker installed on your local machine.

## Let’s get going!

First, we’ll get TensorFlow running without GPUs and time the result.

1. On your local machine,  launch TensorFlow without GPUs using Docker.

	```bash
	docker run -it tensorflow/tensorflow bash
	```

1. Download TensorFlow-Examples.

	```bash
	apt-get update; apt-get install -y git
	git clone https://github.com/aymericdamien/TensorFlow-Examples
	```

1. Run the convolutional network example and time the execution.

	```bash
	cd TensorFlow-Examples/examples/3_NeuralNetworks
	time python convolutional_network.py
	```

That took my machine about 3 minutes.

## TensorFlow example with GPUs

Now, let’s see how GPUs compare.

1. Open a new tab to compare results with next steps with `nvidia-docker`.

1. Make sure you have the latest CUDA drivers installed on your system. Find them at https://developer.nvidia.com/cuda-downloads. As of this writing, version 8.0 is the latest.

1. Download and install nvidia-docker: https://github.com/NVIDIA/nvidia-docker.

	```bash
	wget -P /tmp https://github.com/NVIDIA/nvidia-docker/releases/download/v1.0.1/nvidia-docker_1.0.1_amd64.tar.xz
	sudo tar --strip-components=1 -C /usr/bin -xvf /tmp/nvidia-docker*.tar.xz && rm /tmp/nvidia-docker*.tar.xz
	sudo -b nohup nvidia-docker-plugin > /tmp/nvidia-docker.log
	```

1. Verify your `nvidia-docker` installation.

	```bash
	nvidia-docker run --rm nvidia/cuda nvidia-smi
	nvidia-docker run --rm nvidia/cuda:7.5 nvidia-smi
	```

1. Launch TensorFlow with GPUs using `nvidia-docker`.

	```bash
	nvidia-docker run -it tensorflow/tensorflow:latest-gpu bash
	```

1. Download TensorFlow-Examples.

	```bash
	apt-get update; apt-get install -y git
	git clone https://github.com/aymericdamien/TensorFlow-Examples
	````

1. Run the convolutional network example.

	```bash
	cd TensorFlow-Examples/examples/3_NeuralNetworks
	time python convolutional_network.py
	```

That probably took about 30 seconds: 10 times faster than using just CPUs. The benefits of using GPUs are clear.

## What’s the effect of multiple GPUs?

1. Run the multi-GPU example.

	```bash
	cd ../5_MultiGPU
	time python multigpu_basics.py
	```

Even faster!
