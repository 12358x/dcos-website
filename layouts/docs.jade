include ../mixins/header-docs.jade
include ../mixins/footer-docs.jade

- var path = locals.nav_path.split('/')
- var findPath = function (childPath) { return path.find(function(item) { return item === childPath} ) };

mixin renderMenu(tree)
  ul
    each child in tree
      if(child.file)
        if(findPath(child.path))
          li.docs-nav__item.docs-nav__item_file
            if(locals.nav_path === child.path)
              a(href='/docs/latest/#{child.path}').active #{child.file.post_title}
            else
              a(href='/docs/latest/#{child.path}') #{child.file.post_title}
            if(child.children)
              +renderMenu(child.children)
        else
          li.docs-nav__item.docs-nav__item_file.docs-nav__item--closed
            if(locals.nav_path === child.path)
              a(href='/docs/latest/#{child.path}').active #{child.file.post_title}
            else
              a(href='/docs/latest/#{child.path}') #{child.file.post_title}
            if(child.children)
              +renderMenu(child.children)

      else
        if(findPath(child.name))
          if(child.name !== 'img')
            li.docs-nav__item.docs-nav__item_folder
              a(href='#', data-path='#{child.name}') #{child.name}
              if(child.children)
                +renderMenu(child.children)
        else
          if(child.name !== 'img')
            li.docs-nav__item.docs-nav__item_folder.docs-nav__item--closed
              a(href='#', data-path='#{child.name}') #{child.name}
              if(child.children)
                +renderMenu(child.children)

<!doctype html>
html
  head
    link(rel='stylesheet', type='text/css', href='/styles/index.css')
    meta(name="viewport" content="width=device-width, initial-scale=1")
    link(rel="shortcut icon" type="image/x-icon" href="/assets/images/icons/favicon.ico")

    script.
      var __dcos_docs = !{JSON.stringify(locals.navs.json)};

    block head
      title!= title

  body
    block content
      .container.container--docs-header
        +header

      .container
        .container__content.docs-layout
          .docs-layout__docs-nav
            .docs-search
              input(type='search').docs-search__input
            +renderMenu(locals.navs.header)

          .docs-layout__docs-content
            article!= contents

            .docs-content__footer
              ul.docs-content__footer__actions
                li.docs-content__footer__action
                  img.docs-content__footer__share-icon(src='/assets/images/icons/share.svg')
                  a Share

              ul.docs-content__footer__actions
                li.docs-content__footer__action
                  img.docs-content__footer__feedback-icon(src='/assets/images/icons/feedback.svg')
                  a Submit feedback

      .container
        +footer

  script(src='/scripts/main.js')
  script(src='/assets/scripts/lunr.min.js')
  script(src='/scripts/docs.js')
